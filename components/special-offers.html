<!-- Special Offers Component -->
<div class="section bg-white p-6 rounded-lg" x-data="{
  offers: [
    {
      id: 1,
      title: 'Spa Bath: Relax in Style',
      description: 'Indulge in our luxurious spa facilities',
      price: 59.99,
      type: 'perStay',
      image: 'https://placehold.co/300x300',
    },
    {
      id: 2,
      title: 'Gourmet Dining: Culinary Delights',
      description: 'Experience exquisite flavors and presentation',
      price: 99.00,
      type: 'perPerson',
      image: 'https://placehold.co/300x300',
    },
    {
      id: 3,
      title: 'Adventure Tours: Explore the Wild',
      description: 'Discover exciting outdoor activities',
      price: 150.00,
      type: 'perNight',
      image: 'https://placehold.co/300x300',
    },
    {
      id: 4,
      title: 'Romantic Package',
      description: 'Special touches for a memorable romantic stay',
      price: 75.00,
      type: 'perStay',
      image: 'https://placehold.co/300x300',
    },
    {
      id: 5,
      title: 'Airport Transfer',
      description: 'Hassle-free transportation to/from the airport',
      price: 45.00,
      type: 'perPerson',
      image: 'https://placehold.co/300x300',
    },
    {
      id: 6,
      title: 'Wellness Package',
      description: 'Daily yoga and meditation sessions',
      price: 120.00,
      type: 'perNight',
      image: 'https://placehold.co/300x300',
    },
  ],
  
  // Track selections for each offer
  selections: {
    1: { quantity: 2 },
    2: { quantity: 1, persons: 2 },
    3: { quantity: 1, nights: 3 },
    4: { quantity: 0 },
    5: { quantity: 0, persons: 1 },
    6: { quantity: 0, nights: 1 },
  },
  
  // Format price with euro symbol
  formatPrice(price) {
    return '€' + price.toFixed(2);
  },
  
  // Get unit label based on offer type
  getUnitLabel(type) {
    switch (type) {
      case 'perStay':
        return 'per stay';
      case 'perPerson':
        return 'per person';
      case 'perNight':
        return 'per night';
      default:
        return '';
    }
  },
  
  // Calculate total for an offer
  calculateTotal(offer) {
    const id = offer.id;
    const selection = this.selections[id];
    
    if (selection.quantity === 0) return 0;
    
    switch (offer.type) {
      case 'perPerson':
        return offer.price * selection.quantity * (selection.persons || 1);
      case 'perNight':
        return offer.price * selection.quantity * (selection.nights || 1);
      default: // perStay
        return offer.price * selection.quantity;
    }
  },
  
  // Update quantity for an offer
  updateQuantity(id, change) {
    const newQuantity = Math.max(0, this.selections[id].quantity + change);
    this.selections[id].quantity = newQuantity;
  },
  
  // Book the offer (add to global store)
  bookOffer(id) {
    const offer = this.offers.find(o => o.id === id);
    const selection = this.selections[id];
    
    if (selection.quantity === 0) return;
    
    // Create the offer data
    const offerData = {
      id: offer.id,
      name: offer.title,
      price: this.calculateTotal(offer),
      quantity: selection.quantity,
      type: offer.type
    };
    
    // Add additional data based on type
    if (offer.type === 'perPerson') {
      offerData.persons = selection.persons || 1;
    }
    
    if (offer.type === 'perNight') {
      offerData.nights = selection.nights || 1;
    }
    
    // Add to store
    if (typeof $store !== 'undefined' && $store.booking) {
      $store.booking.updateSpecialOffer(offerData);
    } else {
      console.log('Booked offer:', offerData);
    }
  }
}">
  <div class="text-center mb-8">
    <h2 class="text-3xl font-bold mb-2">¡Ofertas especiales adaptadas para ti!</h2>
    <p class="text-gray-600">Mejora tu estancia con estas experiencias exclusivas.</p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <template x-for="offer in offers" :key="offer.id">
      <!-- Card Component -->
      <div class="rounded border border-gray-200 bg-white overflow-hidden">
        <!-- Image Container -->
        <div class="flex items-center justify-center h-48 bg-gray-100">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </div>

        <!-- Content -->
        <div class="p-4">
          <!-- Title and Description -->
          <h3 class="text-xl font-bold" x-text="offer.title"></h3>
          <p class="text-gray-600 mt-1" x-text="offer.description"></p>

          <!-- Price and Quantity -->
          <div class="mt-4 flex items-center justify-between">
            <div>
              <span class="text-xl font-bold" x-text="formatPrice(offer.price)"></span>
              <span class="text-gray-500 text-sm" x-text="getUnitLabel(offer.type)"></span>
            </div>

            <!-- Quantity Controls -->
            <div class="flex items-center">
              <button class="w-8 h-8 flex items-center justify-center border border-gray-300 rounded-md bg-white"
                @click="updateQuantity(offer.id, -1)">
                <span class="text-lg">−</span>
              </button>
              <span class="mx-3 w-6 text-center" x-text="selections[offer.id].quantity"></span>
              <button class="w-8 h-8 flex items-center justify-center border border-gray-300 rounded-md bg-white"
                @click="updateQuantity(offer.id, 1)">
                <span class="text-lg">+</span>
              </button>
            </div>
          </div>

          <!-- Per Person Controls -->
          <div x-show="offer.type === 'perPerson' && selections[offer.id].quantity > 0" class="mt-4">
            <label class="flex items-center text-sm text-gray-700 mb-1">
              Number of persons
            </label>
            <select x-model="selections[offer.id].persons" class="w-full py-2 px-3 border border-gray-300 rounded-md">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
            </select>
          </div>

          <!-- Per Night Controls -->
          <div x-show="offer.type === 'perNight' && selections[offer.id].quantity > 0" class="mt-4">
            <label class="flex items-center text-sm text-gray-700 mb-1">
              Number of nights
            </label>
            <select x-model="selections[offer.id].nights" class="w-full py-2 px-3 border border-gray-300 rounded-md">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
            </select>
          </div>

          <!-- Total -->
          <div x-show="selections[offer.id].quantity > 0" class="mt-4 bg-gray-100 p-3 rounded-md">
            <div class="flex justify-between items-center">
              <span class="font-medium text-gray-700">Total:</span>
              <span class="font-bold" x-text="formatPrice(calculateTotal(offer))"></span>
            </div>
          </div>

          <!-- Book Now Button - Explicit styles to ensure visibility -->
          <div class="mt-4">
            <button @click="bookOffer(offer.id)"
              style="width: 100%; padding: 12px; margin-top: 8px; background-color: #111827; color: white; font-weight: 500; border-radius: 6px; display: block;">
              Book Now
            </button>
          </div>
        </div>
      </div>
    </template>
  </div>
</div>