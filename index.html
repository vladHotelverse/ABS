<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hotel Booking Experience</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Alpine.js -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <style>
    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 1rem;
    }

    .section {
      margin-bottom: 2rem;
    }
  </style>
</head>

<body class="bg-gray-100">
  <div x-data x-init="lucide.createIcons()">
    <!-- Main Content -->
    <div class="pb-20 md:pb-0">
      <div id="header"></div>
      <div id="booking-bar"></div>
      <section class="grid grid-cols-1 md:grid-cols-[1fr_400px] container gap-4">
        <div class="">
          <div id="room-selection"></div>
          <div id="room-customization"></div>
          <div id="room-location"></div>
          <div id="special-offers"></div>
        </div>
        <div id="pricing-summary" class="hidden md:block"></div>
      </section>
    </div>

    <!-- Bottom Bar for Mobile -->
    <div id="bottom-bar"></div>

    <!-- Global State Script -->
    <script id="booking-state">
      // Global state management for the booking experience
      // Global state management for the booking experience
      document.addEventListener('alpine:init', () => {
        // Create a global store to share data between components
        Alpine.store('booking', {
          // Default values
          selectedRoom: {
            id: 'deluxe-double',
            name: 'Deluxe Double Room',
            price: 0
          },

          // Room customizations
          customizations: {
            camas: null,  // Bed type
            ubicacion: null, // Location
            piso: null,   // Floor
            vista: null   // View
          },

          // Selected special offers (enhanced to support quantity, persons, nights)
          specialOffers: [],

          // Methods to update selections
          selectRoom(room) {
            this.selectedRoom = {
              id: room.id,
              name: room.name,
              price: room.price
            };
            this.updatePricingSummary();
          },

          toggleCustomization(category, option, price, label) {
            if (this.customizations[category] &&
              this.customizations[category].id === option) {
              this.customizations[category] = null;
            } else {
              this.customizations[category] = {
                id: option,
                price: price,
                label: label
              };
            }
            this.updatePricingSummary();
          },

          // Updated method to add or update a special offer
          updateSpecialOffer(offer) {
            const index = this.specialOffers.findIndex(o => o.id === offer.id);

            if (index >= 0) {
              this.specialOffers[index] = offer;
            } else {
              this.specialOffers.push(offer);
            }

            this.updatePricingSummary();
          },

          // New method to remove a special offer
          removeSpecialOffer(offerId) {
            const index = this.specialOffers.findIndex(o => o.id === offerId);

            if (index >= 0) {
              this.specialOffers.splice(index, 1);
              this.updatePricingSummary();
            }
          },

          // Legacy method for backward compatibility
          toggleSpecialOffer(offer) {
            const index = this.specialOffers.findIndex(o => o.id === offer.id);

            if (index >= 0) {
              this.specialOffers.splice(index, 1);
            } else {
              this.specialOffers.push({
                id: offer.id,
                name: offer.title,
                price: parseFloat(offer.price),
                priceUnit: offer.priceUnit || 'per stay',
                quantity: 1
              });
            }
            this.updatePricingSummary();
          },

          // Method to trigger pricing summary update
          updatePricingSummary() {
            // This will be handled by the pricing-summary component itself
            // We're just creating a method to explicitly show this intention
          },

          // Getter method for active customizations
          getActiveCustomizations() {
            return Object.values(this.customizations).filter(item => item !== null);
          },

          // Calculate total price
          calculateTotal() {
            // Base room price (from room selection)
            let total = 299.00; // Base price before customizations

            // Add room upgrade price if selected
            if (this.selectedRoom && this.selectedRoom.price) {
              total += this.selectedRoom.price;
            }

            // Add customization prices
            Object.values(this.customizations).forEach(option => {
              if (option && option.price) {
                total += option.price;
              }
            });

            // Add special offers - use the price that was calculated 
            // with quantity, persons, and nights factored in
            this.specialOffers.forEach(offer => {
              if (offer && offer.price) {
                total += offer.price;
              }
            });

            return total;
          },

          // Calculate taxes (simplified as percentage of subtotal)
          calculateTaxes() {
            return this.calculateTotal() * 0.1; // 10% tax rate
          }
        });
      });
    </script>

    <script>
      // Function to load HTML components
      async function loadComponent(elementId, filePath) {
        try {
          const response = await fetch(filePath);
          const html = await response.text();
          document.getElementById(elementId).innerHTML = html;

          // Re-initialize Lucide icons after loading each component
          lucide.createIcons();
        } catch (error) {
          console.error(`Error loading ${filePath}:`, error);
        }
      }

      // Function to clone pricing summary for mobile
      async function setupMobilePricingSummary() {
        const pricingSummary = document.getElementById('pricing-summary');
        const mobilePricingSummary = document.getElementById('mobile-pricing-summary');

        if (pricingSummary && mobilePricingSummary) {
          // Clone the pricing summary content
          mobilePricingSummary.innerHTML = pricingSummary.innerHTML;

          // Re-initialize any Alpine.js components in the cloned content
          if (window.Alpine) {
            Alpine.initTree(mobilePricingSummary);
          }
        }
      }

      // Load all components when the page loads
      document.addEventListener('DOMContentLoaded', async () => {
        // loadComponent('booking-hero', 'components/booking-hero.html');
        await loadComponent('header', 'components/header.html');
        await loadComponent('booking-bar', 'components/booking-bar.html');
        await loadComponent('room-selection', 'components/room-selection.html');
        await loadComponent('room-customization', 'components/room-customization.html');
        await loadComponent('room-location', 'components/room-location.html');
        await loadComponent('special-offers', 'components/special-offers.html');
        await loadComponent('pricing-summary', 'components/pricing-summary.html');
        await loadComponent('bottom-bar', 'components/bottom-bar.html');

        // Setup mobile pricing summary after all components are loaded
        setupMobilePricingSummary();
      });
    </script>

  </div>
</body>

</html>